/**
 * @name SimpleSearch
 * @desc Search Elemnts by Content
 * @author s.elyounsi
 * @version 1.0.0
 * @date 29.07.2024
*/
class SimpleSearch{constructor(e,t){this.version="1.0.0",this.cache=86400,this.name="SimpleSearch",this.settings=Object.assign({stringLength:2,calcScrollTop:0,scroll:!0,noResults:"No results found!"},t),this.input=document.querySelector(e),this.container=this.createContainer(),this.list=this.createList(),this.parm=new URLSearchParams(window.location.search),this.init()}async init(){this.errorCheck(this.settings)&&this.loadFunction()}async loadFunction(){let e=this,t=(await this.getHTML(this.settings.page)).querySelectorAll(this.settings.elements);this.parm.get("title")&&this.settings.scroll&&this.scrollToElement(this.parm.get("title")),e.input.addEventListener("input",(function(){e.searchFilter(this.value,t)})),e.container.addEventListener("mouseleave",(t=>{e.clearFilter()})),e.input.addEventListener("mouseover",(s=>{e.searchFilter(s.target.value,t)}))}clearFilter(){this.list.innerHTML=""}searchFilter(e,t){let s=this.searchResults(e,t);this.clearFilter(),s.length>=1&&e.length>=this.settings.stringLength?s.forEach((e=>{this.createListItem(e)})):0===s.length?this.createListItem(this.settings.noResults):this.clearFilter()}searchResults(e,t){let s=[];for(let i of t)i.innerText.toLowerCase().includes(e.toLowerCase())&&s.push(i);return s}createListItem(e){let t=document.createElement("li");"object"==typeof e?this.createElement({ele:"a",innerHTML:e.innerText,title:e.innerText,href:`${this.settings.page}?title=${e.innerText}`},t):t.innerHTML=e,this.list.appendChild(t)}scrollToElement(e){let t=document.querySelectorAll(this.settings.elements);for(let s of t)if(s.innerText.includes(e)){s.classList.add("active");const e=s.getBoundingClientRect().top+window.pageYOffset+this.settings.calcScrollTop;window.scrollTo({top:e,behavior:"smooth"})}}createList(){return this.createElement({ele:"ul",placeholder:this.settings.placeholder,classList:`${this.name}List`},this.container)}createContainer(){let e=document.createElement("div");return e.classList=`${this.name}Container`,this.input.after(e),e.appendChild(this.input),e}errorCheck(e){return this.input?!!e.page||(this.errorMessage("Path to the subpage is missing!"),!1):(this.errorMessage("Search field could not be found, please check the selector!"),!1)}errorMessage(e){console.error(`${this.name} - ${this.version}: ${e}`)}createElement(e,t,s=!1){let i=document.createElement(e.ele),n=!!e?.dataset&&e.dataset;delete e.ele,delete e.dataset;for(let t in e)i[t]=e[t];if(n)for(let e in n)i.dataset[e]=n[e];return s?t.insertBefore(i,t.firstChild):t.appendChild(i),i}async asyncGet(e){return fetch(e,{headers:{"Cache-Control":`max-age=${this.cache}`}})}async getHTML(e){return this.asyncGet(e).then((e=>e.text())).then((e=>(new DOMParser).parseFromString(e,"text/html")))}}